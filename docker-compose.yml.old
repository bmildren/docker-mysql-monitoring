version: '2'
services:
  prometheus_data:
    image: prom/prometheus
    container_name: prom-storage
    volumes:
      - ./prometheus/data:/prometheus

#  grafana_data:
#    image: grafana/grafana
#    container_name: graf-storage
#    volumes:
#      - ./grafana/data:/var/lib/grafana

#  influxdb_data:
#    image: tutum/influxdb
#    container_name: influx-data
#    volumes:
#      - ./influxdb/data:/data

#  prometheus:
#    image: prom/prometheus
#    container_name: prom
#    volumes:
#      - ./prometheus/config:/etc/prometheus
#    volumes_from:
#      - prom-storage
#    ports:
#      - "9090:9090"
#    networks:
#      - monitor
#    command: [ "-config.file=/etc/prometheus/prometheus.yml", 
#               "-storage.local.path=/prometheus", 
#               "-storage.local.retention=168h", 
#               "-storage.local.memory-chunks=524288", 
#               "-storage.remote.influxdb-url=http://localhost:8086", 
#               "-web.console.libraries=/etc/prometheus/console_libraries", 
#               "-web.console.templates=/etc/prometheus/consoles" ]

#  grafana:
#    image: grafana/grafana
#    container_name: graf
#    volumes: 
#      - ./grafana/config:/etc/grafana
#    volumes_from:
#      - graf-storage
#    environment:
#      - GF_SERVER_ROOT_URL=http://grafana.percona.demo
#      - GF_SECURITY_ADMIN_PASSWORD=admin
#    ports:
#      - "3000:3000"
#    networks:
#      - monitor

#  grafana_post:
#    build:
#      context: ./grafana/post-scripts
#    container_name: grafana_post
#    networks:
#      - monitor
#    command: curl http://admin:admin@localhost:3000/api/datasources -X POST -H 'Content-Type: application/json' --data-binary '{"name": "Prometheus","type": "prometheus","url": "http://localhost:9090","access": "proxy","isDefault": true}' ; sed -i 's/step_input:""/step_input:c.target.step/; s/ HH:MM/ HH:mm/; s/,function(c)/,"templateSrv",function(c,g)/; s/expr:c.target.expr/expr:g.replace(c.target.expr,c.panel.scopedVars)/' /usr/share/grafana/public/app/plugins/datasource/prometheus/query_ctrl.js ; sed -i 's/h=a.interval/h=g.replace(a.interval, c.scopedVars)/' /usr/share/grafana/public/app/plugins/datasource/prometheus/datasource.js`

#  influxdb:
#    image: tutum/influxdb
#    container_name: influx
#    volumes_from: 
#      - influx-storage
#    environment:
#      - PRE_CREATE_DB=prometheus
#    ports:
#      - "8083:8083"
#      - "8086:8086"
#    networks:
#      - monitor

networks:
  monitor:
    driver=bridge
